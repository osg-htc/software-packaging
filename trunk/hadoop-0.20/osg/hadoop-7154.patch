--- bin/hadoop-config.sh.orig	2010-10-11 11:39:27.000000000 -0500
+++ bin/hadoop-config.sh	2012-12-17 14:19:50.094502779 -0600
@@ -108,6 +108,12 @@
   fi
 fi
 
+# Newer versions of glibc use an arena memory allocator that causes virtual
+# memory usage to explode. This interacts badly with the many threads that
+# we use in Hadoop. Tune the variable down to prevent vmem explosion.
+export MALLOC_ARENA_MAX=${MALLOC_ARENA_MAX:-4}
+
+
 if [ -d $HADOOP_HOME/pids ]; then
 HADOOP_PID_DIR="${HADOOP_PID_DIR:-$HADOOP_HOME/pids}"
 fi
