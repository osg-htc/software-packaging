diff --git a/cvmfs/util/posix.cc b/cvmfs/util/posix.cc
index 36cd4f1..25c5541 100644
--- a/cvmfs/util/posix.cc
+++ b/cvmfs/util/posix.cc
@@ -896,14 +896,22 @@ vector<string> FindDirectories(const string &parent_dir) {
  * Name -> UID from passwd database
  */
 bool GetUidOf(const std::string &username, uid_t *uid, gid_t *main_gid) {
-  char buf[16*1024];
   struct passwd pwd;
   struct passwd *result = NULL;
-  getpwnam_r(username.c_str(), &pwd, buf, sizeof(buf), &result);
-  if (result == NULL)
+#ifdef _SC_GETPW_R_SIZE_MAX
+  int bufsize = sysconf(_SC_GETPW_R_SIZE_MAX);
+#else
+  int bufsize = 16 * 1024;
+#endif
+  char *buf = static_cast<char *>(smalloc(bufsize));
+  getpwnam_r(username.c_str(), &pwd, buf, bufsize, &result);
+  if (result == NULL) {
+    free(buf);
     return false;
+  }
   *uid = result->pw_uid;
   *main_gid = result->pw_gid;
+  free(buf);
   return true;
 }
 
@@ -912,13 +920,29 @@ bool GetUidOf(const std::string &username, uid_t *uid, gid_t *main_gid) {
  * Name -> GID from groups database
  */
 bool GetGidOf(const std::string &groupname, gid_t *gid) {
-  char buf[16*1024];
   struct group grp;
-  struct group *result;
-  getgrnam_r(groupname.c_str(), &grp, buf, sizeof(buf), &result);
-  if (result == NULL)
+  struct group *result = NULL;
+#ifdef _SC_GETGR_R_SIZE_MAX
+  int bufsize = sysconf(_SC_GETGR_R_SIZE_MAX);
+#else
+  int bufsize = 16 * 1024;
+#endif
+
+  if (bufsize == -1)
+    bufsize = 16*1024;
+  char *buf = static_cast<char *>(smalloc(bufsize));
+  while (getgrnam_r(groupname.c_str(), &grp, buf, bufsize, &result) == ERANGE) {
+    // Buffer was too small.  The getgrnam_r man page says to
+    // try again with a larger buffer, so try doubling it.
+    bufsize *= 2;
+    buf = static_cast<char *>(srealloc(buf, bufsize));
+  }
+  if (result == NULL) {
+    free(buf);
     return false;
+  }
   *gid = result->gr_gid;
+  free(buf);
   return true;
 }
 
