From 002e8c8b59f3d6f66cc4b73a4c99bfddc20780be Mon Sep 17 00:00:00 2001
From: matyas <matyas@4e558342-562e-0410-864c-e07659590f8c>
Date: Thu, 20 Nov 2014 00:19:20 +0000
Subject: [PATCH] Add AllowedVOs attribute to ResourceCatalog (SOFTWARE-1688)

git-svn-id: file:///p/vdt/workspace/svn/software/osg-configure/trunk@20157 4e558342-562e-0410-864c-e07659590f8c
---
 osg_configure/modules/resourcecatalog.py | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/osg_configure/modules/resourcecatalog.py b/osg_configure/modules/resourcecatalog.py
index bacddb8..a456e0f 100644
--- a/osg_configure/modules/resourcecatalog.py
+++ b/osg_configure/modules/resourcecatalog.py
@@ -34,9 +34,6 @@ class ResourceCatalog(object):
     if not memory > 0:
       raise ValueError("Parameter 'memory' out of range at %r; must be > 0" % memory)
 
-    if isinstance(allowed_vos, str):
-      allowed_vos = re.split('[ ,]+', allowed_vos)
-
     attributes = {'Name': utilities.classad_quote(name),
                   'CPUs': cpus,
                   'Memory': memory}
@@ -46,8 +43,11 @@ class ResourceCatalog(object):
       requirements_clauses.append(extra_requirements)
 
     if allowed_vos:
-      vo_clauses = ['TARGET.VO == %s' % utilities.classad_quote(vo) for vo in allowed_vos if vo]
-      requirements_clauses.append("(%s)" % " || ".join(vo_clauses))
+      if isinstance(allowed_vos, str):
+        allowed_vos = re.split('[ ,]+', allowed_vos)
+      allowed_vos = "{ " + ", ".join([utilities.classad_quote(vo) for vo in allowed_vos]) + " }"
+      attributes['AllowedVOs'] = allowed_vos
+      requirements_clauses.append("member(TARGET.VO, AllowedVOs)")
 
     attributes['Requirements'] = ' && '.join(requirements_clauses)
 
-- 
2.0.1

