# COMMON:

%triggerpostun -- jdk = %{epoch}:%{version}
javadir=/usr/java/jdk%{version}

echo Checking symlinks...
# If we're really uninstalling, then just exit
if [[ $1 -eq 0 ]]; then
    echo Uninstalling... not needed.
    exit 0
fi
if [[ ! -e $javadir ]]; then
    echo $javadir not found... not needed.
    exit 0
fi

# Recreate service tag
if [[ -e $javadir/bin/java ]]; then
    echo Recreating service tag
    $javadir/bin/java com.sun.servicetag.Installer -source "jdk" &> /dev/null
fi

# Recreate symlinks that the preun script removes
if [[ ! -e /usr/java/latest ]]; then
    echo Recreating /usr/java/latest symlink
    ln -s $javadir /usr/java/latest
fi
if [[ ! -e /usr/java/default ]]; then
    echo Recreating /usr/java/default symlink
    ln -s /usr/java/latest /usr/java/default
fi
for prog in jar java javac javadoc javaws jcontrol; do
    if [[ ! -e /usr/bin/$prog ]]; then
        echo Recreating /usr/bin/$prog symlink
        ln -s /usr/java/default/bin/$prog /usr/bin/$prog
    fi
done

# Also turn on jexec
/sbin/chkconfig --add jexec &> /dev/null || :
/etc/init.d/jexec start &> /dev/null || :


