--- resources/scripts/init-voms-admin.py.orig   2011-07-21 13:45:25.000000000 -0500
+++ resources/scripts/init-voms-admin.py        2011-07-21 13:47:12.000000000 -0500
@@ -25,6 +25,9 @@

 import getopt, sys, os, os.path, commands,urllib,xml.dom.minidom, getopt, shutil, time, re, glob

+os.environ.setdefault("CATALINA_HOME", "/usr/share/tomcat5")
+os.environ.setdefault("VOMS_ADMIN_LOCATION_VAR", "/")
+
 def voms_admin_config_dir_prefix():
     conf_dir_prefix = os.environ.get('VOMS_ADMIN_LOCATION_VAR')
     if conf_dir_prefix is None:
--- resources/scripts/voms-admin-configure.py.orig	2011-07-27 17:45:06.000000000 -0500
+++ resources/scripts/voms-admin-configure.py	2011-07-27 18:06:10.000000000 -0500
@@ -92,7 +92,34 @@
             raise VomsConfigureError, "User unknown: %s" % options['config-owner']        
         
         user_id = pwd_info[2]
-    
+
+
+    voms_group = None
+    if not options.has_key("voms-group"):
+        if user_id == 0:
+            for group in ['voms']:
+                try:
+
+                    if grp.getgrnam(group):
+                        (gr_name,gr_passwd, gr_gid,gr_mem) = grp.getgrnam(group)
+                        options['voms-group-id']=gr_gid
+                        break
+
+                except KeyError, k:
+                    continue
+
+            if not options.has_key('voms-group-id'):
+                raise VomsConfigureError,"Please specify the --voms-group option. The default 'voms' are not applicable to your system."
+        else:
+            options['voms-group-id'] = os.getgid()
+    else:
+        try:
+            (gr_name,gr_passwd, gr_gid,gr_mem) =  grp.getgrnam(options['voms-group'])
+            options['voms-group-id']=gr_gid
+
+        except KeyError, k:
+            raise VomsConfigureError, "The voms-group passed as argument (%s) does not exist on this system!" % options['voms-group']
+ 
     tomcat_group = None
     
     if not options.has_key("tomcat-group"):
@@ -138,8 +165,8 @@
     options['ta.subject']=certificate.subject
     options['ta.ca']=certificate.issuer
 
- 
-    
+
+
 def check_installed_setup():
     
     vlog("VOMS_LOCATION: %s" % VomsConstants.voms_loc)
 
--- resources/scripts/voms.py.orig	2011-07-27 17:45:28.000000000 -0500
+++ resources/scripts/voms.py	2011-07-27 18:01:38.000000000 -0500
@@ -22,6 +22,12 @@
 
 voms_admin_server_version = "${server-version}"
 
+os.environ.setdefault("VOMS_ADMIN_LOCATION_VAR", "/")
+os.environ.setdefault("VOMS_LOCATION_VAR", "/var")
+os.environ.setdefault("VOMS_LOCATION", "/usr")
+os.environ.setdefault("VOMS_ADMIN_LOCATION", "/usr/share/voms-admin")
+os.environ.setdefault("VOMS_LOCATION_CONF", "/")
+
 def exit_status(status):
     if os.WIFEXITED(status):
         return os.WEXITSTATUS(status)
@@ -133,6 +139,7 @@
 
 class ConfigureAction:
     def __init__(self,name,required_options,user_options):
+	
         self.name = name
         self.required_options=required_options
         self.user_options=user_options
@@ -702,7 +709,9 @@
              'VONAME': self.user_options['vo'],
              'PORT': self.user_options['port'],
              'URI': self.user_options['uri'],
-             'TIMEOUT': self.user_options['timeout']}
+             'TIMEOUT': self.user_options['timeout'],
+             'X509_USER_CERT':self.user_options['cert'],	
+             'X509_USER_KEY':self.user_options['key']}
         
         t = Template(open(VomsConstants.voms_template,"r").read())
         
@@ -722,6 +731,10 @@
         
         os.chmod(voms_config_file(self.user_options['vo']),0640)
         os.chmod(voms_pass_file(self.user_options['vo']), 0640)
+        if os.getgid() == 0:
+        	os.chown(voms_config_file(self.user_options['vo']), 0,self.user_options['voms-group-id'])
+        	os.chown(voms_pass_file(self.user_options['vo']), 0,self.user_options['voms-group-id'])
+
         
     
     def write_vomses(self):

--- resources/templates/voms.conf.template.orig	2011-07-27 17:48:59.000000000 -0500
+++ resources/templates/voms.conf.template	2011-07-27 17:56:11.000000000 -0500
@@ -9,4 +9,6 @@
 --username=@USERNAME@
 --vo=@VONAME@
 --uri=@URI@
---timeout=@TIMEOUT@
\ No newline at end of file
+--timeout=@TIMEOUT@
+--x509_user_cert=@X509_USER_CERT@
+--x509_user_key=@X509_USER_KEY@
