From a7790569721c5d0e37b411e1f3f58c7b1162e0b9 Mon Sep 17 00:00:00 2001
From: root <root@fermicloud382.fnal.gov>
Date: Tue, 10 Dec 2019 14:16:04 -0600
Subject: [PATCH 1/2] Rebuild for xrootd 5.0-rc1 (software-3923)

---
 CMakeLists.txt         | 2 +-
 cmake/FindXrootd.cmake | 9 +++++++++
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 788834d..6c443f8 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -45,7 +45,7 @@ target_link_libraries(XrdHdfs ${XROOTD_UTILS} ${DL_LIB} ${LIBCRYPTO_LIBRARIES} $
 set_target_properties(XrdHdfs PROPERTIES LINK_FLAGS "-Wl,--version-script=${CMAKE_SOURCE_DIR}/src/export-lib-symbols")
 
 add_library(XrdHdfsReal MODULE src/XrdHdfs.cc src/XrdHdfsConfig.cc src/XrdHdfs.hh src/XrdHdfsChecksum.cc src/XrdHdfsChecksumCalc.cc)
-target_link_libraries(XrdHdfsReal ${HDFS_LIB} ${XROOTD_UTILS} ${LIBCRYPTO_LIBRARIES} ${ZLIB_LIBRARIES})
+target_link_libraries(XrdHdfsReal ${HDFS_LIB} ${XROOTD_UTILS} ${XROOTD_SERVER} ${LIBCRYPTO_LIBRARIES} ${ZLIB_LIBRARIES})
 set_target_properties(XrdHdfsReal PROPERTIES LINK_FLAGS "-Wl,--version-script=${CMAKE_SOURCE_DIR}/src/export-lib-symbols")
 
 add_executable(xrootd_hdfs_envcheck src/XrdHdfsEnvCheck.cc)
diff --git a/cmake/FindXrootd.cmake b/cmake/FindXrootd.cmake
index e7a1bc8..f242bd8 100644
--- a/cmake/FindXrootd.cmake
+++ b/cmake/FindXrootd.cmake
@@ -18,6 +18,15 @@ FIND_LIBRARY(XROOTD_UTILS XrdUtils
   PATH_SUFFIXES lib
 )
 
+FIND_LIBRARY(XROOTD_SERVER XrdServer
+  HINTS
+  ${XROOTD_DIR}
+  $ENV{XROOTD_DIR}
+  /usr
+  /opt/xrootd/
+  PATH_SUFFIXES lib
+)
+
 INCLUDE(FindPackageHandleStandardArgs)
 FIND_PACKAGE_HANDLE_STANDARD_ARGS(Xrootd DEFAULT_MSG XROOTD_UTILS XROOTD_INCLUDES)
 
